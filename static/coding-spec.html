<h1 id="-">后端编码规范</h1>
<h2 id="1-">1.格式与命名规范</h2>
<h3 id="1-1-">1.1    缩进</h3>
<p>考虑到代码在所有设备和终端保持同样的排版，代码中不允许使用 Tab，统一采用4个空格作为缩进单位。IDEA 设置 tab 为 4 个空格时， 请勿勾选 <code>Use tab character</code>,而在eclipse中，必须勾选<code>insert spaces for tabs</code></p>
<h3 id="1-2-">1.2    换行</h3>
<p>每行限制最长120字符，超过120列的行，应按照规范换行。
考虑到如今电脑宽屏为主，120列可以充分利用宽屏空间，也可以避免过多换行。
换行时遵循如下原则:</p>
<ul>
<li>第二行相对第一行缩进 4 个空格，从第三行开始，不再继续缩进</li>
<li>运算符与下文一起换行</li>
<li>方法调用的点符号与下文一起换行</li>
<li>在多个参数超长，在逗号后换行</li>
<li>在括号前不要换行。
示例：</li>
</ul>
<pre><code class="lang-java">
StringBuffer sb = <span class="hljs-built_in">new</span> StringBuffer();
//超过 <span class="hljs-number">120</span> 个字符的情况下，换行缩进 <span class="hljs-number">4</span> 个空格，并且方法前的点符号一起换行 sb.<span class="hljs-built_in">append</span>(<span class="hljs-string">"zi"</span>).<span class="hljs-built_in">append</span>(<span class="hljs-string">"xin"</span>)...
          .<span class="hljs-built_in">append</span>(<span class="hljs-string">"huang"</span>)...
          .<span class="hljs-built_in">append</span>(<span class="hljs-string">"huang"</span>)...
          .<span class="hljs-built_in">append</span>(<span class="hljs-string">"huang"</span>);
</code></pre>
<h3 id="1-3-">1.3    命名规则</h3>
<ul>
<li>代码中的命名均不能以<code>下划线或美元符号</code>开始，也不能以<code>下划线或美元符号</code>结束</li>
<li>代码中的命名严禁使用拼音与英文混合的方式，更不允许直接使用中文的方式,纯拼音命名也要避免采用</li>
<li>类名使用 UpperCamelCase 风格，必须遵从驼峰形式</li>
<li>方法名、参数名、成员变量、局部变量都统一使用 lowerCamelCase 风格，必须遵从驼峰形式</li>
<li>遇到缩写如XML时，仅首字母大写，即loadXmlDocument()而不是loadXMLDocument()</li>
<li>常量命名全部大写，单词间用下划线隔开，力求语义表达完整清楚</li>
<li>抽象类命名使用 Abstract 或 Base 开头;异常类命名使用 Exception 结尾;测试类 命名以它要测试的类的名称开始，以 Test 结尾</li>
<li>Package名必须全部小写，尽量使用单个单词</li>
<li>局部变量及输入参数不要与类成员变量同名(get/set方法与构造函数除外)</li>
<li>中括号是数组类型的一部分，数组定义如下:String[] args</li>
<li>接口类中的方法和属性不要加任何修饰符号(public 也不要加)，保持代码的简洁性，并加上有效的 Javadoc 注释。尽量不要在接口里定义变量，如果一定要定义变量，肯定是与接口方法相关，并且是整个应用的基础常量</li>
</ul>
<h3 id="1-4-">1.4 代码格式</h3>
<ul>
<li>大括号的使用约定。如果是大括号内为空，则简洁地写成{}即可，不需要换行;如果是非空代码块则:<ul>
<li>左大括号前不换行</li>
<li>左大括号后换行</li>
<li>右大括号前换行</li>
<li>右大括号后还有else等代码则不换行;表示终止的右大括号后必须换行</li>
</ul>
</li>
<li>左小括号和字符之间不出现空格;同样，右小括号和字符之间也不出现空格，如 if (a == b)</li>
<li>if/for/while/switch/do 等保留字与括号之间都必须加空格</li>
<li>任何二目、三目运算符的左右两边都需要加一个空格。包括赋值运算符=、逻辑运算符&amp;&amp;、加减乘除符号等</li>
<li>方法参数在定义和传入时，多个参数逗号后边必须加空格。</li>
<li>IDE的text file encoding设置为UTF-8; IDE中文件的换行符使用Unix格式， 不要使用 windows 格式。</li>
</ul>
<h3 id="1-5-">1.5    声明</h3>
<ul>
<li>修饰符应该按照如下顺序排列：public, protected, private, abstract, static, final, transient, volatile, synchronized, native, strictfp。</li>
<li>类与接口的声明顺序(可用Eclipse的source-&gt;sort members功能自动排列):  <ul>
<li>静态成员变量 / Static Fields </li>
<li>静态初始化块 / Static Initializers </li>
<li>成员变量 / Fields </li>
<li>初始化块 / Initializers </li>
<li>构造器 / Constructors </li>
<li>静态成员方法 / Static Methods </li>
<li>成员方法 / Methods </li>
<li>重载自Object的方法如toString(), hashCode() 和main方法</li>
<li>类型(内部类) / Types(Inner Classes) </li>
<li>同等的类型，按public, protected, private的顺序排列。</li>
</ul>
</li>
</ul>
<h2 id="2-">2    注释规范</h2>
<h3 id="2-1-">2.1    注释类型</h3>
<h4 id="2-1-1-javadoc-">2.1.1      Javadoc 注释</h4>
<p>Javadoc块的基本格式如下所示：</p>
<pre><code class="lang-java"><span class="hljs-comment">/**
 * Multiple lines of Javadoc text are written here,
 * wrapped normally…
 */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">method</span><span class="hljs-params">(String p1)</span></span>{…}
</code></pre>
<p>或者是以下单行形式：</p>
<pre><code class="lang-java"><span class="hljs-comment"><span class="markdown">/<span class="hljs-emphasis">** An especially short bit of Javadoc. *</span>/</span></span>
</code></pre>
<p>基本格式总是OK的。当整个Javadoc块能容纳于一行时(且没有Javadoc标记@XXX)，可以使用单行形式。
所有的抽象方法(包括接口中的方法)都应该使用 Javadoc 注释、除了返回值、参数、异常说明外，还必须指出该方法做什么事情，实现什么功能。</p>
<h4 id="2-1-2-">2.1.2    失效代码注释</h4>
<p>由<code>/*…*/</code>界定，标准的C-Style注释，专用于注释已失效的代码。</p>
<pre><code class="lang-java"><span class="hljs-comment">/*
 *Comment out the code
 * …
 */</span>
</code></pre>
<h4 id="2-1-3-">2.1.3     代码细节注释</h4>
<p>由<code>//</code>界定，专用于注释代码细节，即使有多行注释也仍然使用<code>//</code>，以便于<code>/**/</code>区分开来。
    除了私有变量，不推荐使用行末注释。</p>
<pre><code class="lang-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> {</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> myField; <span class="hljs-comment">// An end-line comment.</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> myMethod {
<span class="hljs-comment">//a very very long</span>
       <span class="hljs-comment">//comment.</span>
       <span class="hljs-keyword">if</span> (condition1) {
<span class="hljs-comment">//condition1 comment</span>
          ...
        } <span class="hljs-keyword">else</span> {
<span class="hljs-comment">//elses condition comment</span>
          ...
        }
    }
}
</code></pre>
<h3 id="2-2-">2.2    注释的格式</h3>
<ul>
<li>注释中的第一个句子要以（英文）句号、问号或者感叹号结束。Javadoc生成工具会将注释中的第一个句子放在方法汇总表和索引中。</li>
<li>为了在JavaDoc和IDE中能快速链接跳转到相关联的类与方法，尽量多的使用<code>@see XXx.MyClass，@see XX.MyClass#find(String)</code>。</li>
<li>Class必须以<code>@author</code> 作者名声明作者，不需要声明<code>@version</code>与<code>@date</code>，由版本管理系统保留此信息。</li>
<li>如果注释中有超过一个段落，用<code>&lt;p&gt;</code>分隔。</li>
<li>示例代码以<code>&lt;pre&gt;&lt;/pre&gt;</code>包裹。</li>
<li>标识(java keyword, class/method/field/argument名，Constants) 以<code>&lt;code&gt;&lt;/code&gt;</code>包裹。</li>
<li>标识在第一次出现时以<code>{@linkXXx.Myclass}</code>注解以便JavaDoc与IDE中可以链接。</li>
</ul>
<h3 id="2-3-">2.3    注释的内容</h3>
<h4 id="2-3-1-">2.3.1    可精简的注释内容</h4>
<p>注释中的每一个单词都要有其不可缺少的意义，注释里不写&quot;@param name -名字&quot;这样的废话。
    如果该注释是废话，连同标签删掉它，而不是自动生成一堆空的标签，如空的@param name，空的<code>@return</code>。</p>
<h4 id="2-3-2-">2.3.2    推荐的注释内容</h4>
<ul>
<li>对于API函数如果存在契约，必须写明它的前置条件(precondition)，后置条件(postcondition)，及不变式(invariant)。</li>
<li>对于调用复杂的API尽量提供代码示例。</li>
<li>对于已知的Bug需要声明。</li>
<li>在本函数中抛出的unchecked exception尽量用@throws说明。</li>
</ul>
<h4 id="2-3-3-null-">2.3.3    Null规约</h4>
<p>如果方法允许null作为参数，或者允许返回值为null，必须在JavaDoc中说明。
    如果没有说明，方法的调用者不允许使用null作为参数，并认为返回值是nullSafe的。</p>
<pre><code class="lang-java">/**
 * 获取对象.
 *
 * @ <span class="hljs-literal">return</span> <span class="hljs-keyword">the</span> object <span class="hljs-keyword">to</span> found <span class="hljs-keyword">or</span> null <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> found.
 */
Object <span class="hljs-keyword">get</span>(Integer <span class="hljs-built_in">id</span>){
    ...
}
</code></pre>
<h4 id="2-3-4-">2.3.4    特殊代码注释</h4>
<ul>
<li>代码质量不好但能正常运行，或者还没有实现的代码用<code>//TODO</code>: 或 <code>//XXX</code>:声明</li>
<li>存在错误隐患的代码用<code>//FIXME</code>:声明</li>
</ul>
<h2 id="3-">3    编程规范</h2>
<h3 id="3-1-">3.1    基本规范</h3>
<ol>
<li>当面对不可知的调用者时，方法需要对输入参数进行校验，如不符合抛出IllegalArgumentException，建议使用Spring的Assert系列函数。</li>
<li>隐藏工具类的构造器，确保只有static方法和变量的类不能被构造实例。</li>
<li>变量，参数和返回值定义尽量基于接口而不是具体实现类，如<code>Map map = new HashMap();</code></li>
<li>代码中不能使用<code>System.out.println()</code>，<code>e.printStackTrace()</code>，必须使用logger打印信息。</li>
<li>关于基本数据类型与包装数据类型的使用标准如下:<ul>
<li>所有的POJO类属性必须使用包装数据类型。</li>
<li>RPC方法的返回值和参数必须使用包装数据类型。</li>
<li>所有的局部变量使用基本数据类型。</li>
</ul>
</li>
<li>循环体内，字符串的连接方式，使用 StringBuilder 的 append 方法进行扩展。</li>
</ol>
<h3 id="3-2-">3.2    异常处理</h3>
<ol>
<li>重新抛出的异常必须保留原来的异常，即<code>throw new NewException(&quot;message&quot;, e);</code> 而不能写成<code>throw new NewException(&quot;message&quot;)</code>。</li>
<li>在所有异常被捕获且没有重新抛出的地方必须写日志。  </li>
<li>如果属于正常异常的空异常处理块必须注释说明原因，否则不允许空的catch块。</li>
<li>框架尽量捕获低级异常，并封装成高级异常重新抛出，隐藏低级异常的细节。</li>
</ol>
<h3 id="3-3-jdk8">3.3    JDK8</h3>
<p>HAP开发以及运行环境统一采用 java 1.8.15（或以上）版本。项目开发人员可使用 java8所提供的特性来是代码更简练。如lambda 表达式等，同时，也要充分利用 java 高版本所带来的便利，如 Annotation 等。</p>
<p>不需要关心的warning信息用<code>@SuppressWarnings(&quot;unused&quot;)</code>, <code>@SuppressWarnings(&quot;unchecked&quot;)</code>, <code>@SuppressWarnings(&quot;serial&quot;)</code> 注释。</p>
