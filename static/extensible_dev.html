<h2 id="-">å¯æ‰©å±•å¼€å‘æ¨¡å¼</h2>
<h2 id="1-">1.æŒä¹…å±‚æ‰©å±•</h2>
<hr>
<p>HAP å¯¹ mybatis çš„å°è£…è¿˜æ˜¯æ¯”è¾ƒå®Œå–„çš„ï¼ŒåŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ï¼Œä¸éœ€è¦å†™ SQLï¼Œè¿™äº›å½’åŠŸäº DTOï¼Œå’Œå®ƒä¸Šé¢çš„ä¸€äº›æ³¨è§£ã€‚</p>
<p>é€šè¿‡ DTOï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“è¡¨æœ‰å“ªäº›å­—æ®µï¼Œä»€ä¹ˆç±»å‹ï¼Œè‡ªç„¶å¢åˆ æ”¹æŸ¥å°±å¯ä»¥è‡ªåŠ¨å®Œæˆäº†ã€‚</p>
<p>å¦‚æœæƒ³è¦ç»™è¡¨åŠ ä¸€ä¸ªå­—æ®µï¼Œæ•°æ®åº“å±‚é¢æ¯”è¾ƒå¥½è§£å†³ï¼Œç›´æ¥åŠ å°±å¥½äº†ã€‚<br>ä½† DTO ä¸Šæ²¡æœ‰è¿™ä¸ªå­—æ®µï¼Œå°±ä¼šå¯¼è‡´è¿™ä¸ªå­—æ®µå®Œå…¨æ²¡æ„ä¹‰ã€‚   </p>
<blockquote>
<p>æ€ä¹ˆæ ·è®© DTO ä¸Šèƒ½å¢åŠ ä¸€ä¸ªå­—æ®µå‘¢ï¼Ÿå†™ä¸€ä¸ªå­ç±»ç»§æ‰¿å®ƒï¼Ÿä¼¼ä¹æ²¡åŠæ³•èå…¥åˆ°åŸæœ‰çš„é€»è¾‘ä¸­å»ã€‚   </p>
</blockquote>
<p>HAP é‡‡ç”¨çš„åŠæ³•æ˜¯ï¼šç”¨<code>JAVAssist</code>æ¯”è¾ƒåº•å±‚çš„å­—èŠ‚ç ä¿®æ”¹ï¼Œç›´æ¥å»ä¿®æ”¹è¿™ä¸ªç±»ã€‚   </p>
<h3 id="-">æ¥å£</h3>
<p>æ›´å…·ä½“ä¸€ç‚¹ï¼Œæˆ‘ä»¬å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ä¸€ä¸ª<code>æ¥å£</code>ï¼Œæ¥å£é‡Œé¢ä»…å…è®¸å®šä¹‰ <code>getter</code>ï¼Œ<code>setter</code> æ–¹æ³•ï¼Œå¹¶å¯ä»¥åœ¨<code>setter</code> ä¸Šå†™æ³¨è§£(åŸå…ˆæ˜¯å†™åœ¨ Field ä¸Š)</p>
<pre><code class="lang-java">public<span class="hljs-built_in"> interface </span>UserDemoExt {

    @ColumnType(jdbcType = JdbcType.VARCHAR)
    void setUserPhone(String userPhone);

    String getUserPhone();

}
</code></pre>
<p>è¯·æ³¨æ„ä¸€ç‚¹ï¼š</p>
<blockquote>
<p>å¦‚æœè¿™ä¸ªæ¥å£<code>ç»§æ‰¿</code>äº†å…¶ä»–æ¥å£ï¼ŒHAP åªä¼šå¤„ç†è¿™ä¸ªæ¥å£æœ¬èº«å®šä¹‰çš„æ–¹æ³•ï¼<br>æ¢å¥è¯è¯´ï¼Œä½ éœ€è¦ä¿è¯ DTO å·²ç»å…·æœ‰æŸä¸ªæ‰©å±•Aäº†ï¼Œåé¢åŠ çš„æ‰©å±•æ¥å£æ‰å¯ä»¥ç»§æ‰¿Aã€‚   </p>
</blockquote>
<h3 id="-">é…ç½®æ–‡ä»¶</h3>
<p>ç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­å£°æ˜   </p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">extension-register</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">extension</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"com.hand.hap.testext.dto.UserDemo"</span> <span class="hljs-attr">extension</span>=<span class="hljs-string">"com.hand.hap.testext.dto.UserDemoExt"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">extension</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">extension-register</span>&gt;</span>
</code></pre>
<blockquote>
<p>é…ç½®æ–‡ä»¶å‘½åè§„åˆ™ï¼š<code>*.extend.xml</code><br>å­˜æ”¾ä½ç½®ï¼š<code>resources/extension</code> å­ç›®å½•ä»»æ„å®šä¹‰</p>
</blockquote>
<p>è¦å¯¹ <code>com.hand.hap.testext.dto.UserDemo</code> è¿›è¡Œæ‰©å±•ï¼Œ<br>å¢åŠ çš„æ¥å£æ˜¯ <code>com.hand.hap.testext.dto.UserDemoExt</code>ã€‚   </p>
<p><code>extension èŠ‚ç‚¹</code>å¯ä»¥åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­å†™å¤šä¸ªã€‚</p>
<p>å…³äºè¿™ä¸ªæ¥å£çš„å®ç°ï¼Œå¼€å‘è€…å®Œå…¨ä¸éœ€è¦å…³å¿ƒï¼Œ<code>HAP ä¼šè‡ªåŠ¨å®ç°è¿™äº›æ–¹æ³•çš„åŠŸèƒ½</code>ã€‚</p>
<p>ONE MORE THING</p>
<blockquote>
<p>DTO çš„æ‰©å±•ï¼Œä»…å…è®¸å¢åŠ æ–°çš„å­—æ®µï¼Œä¸å…è®¸ä¿®æ”¹ã€åˆ é™¤å·²æœ‰çš„å­—æ®µï¼</p>
</blockquote>
<hr>
<p>é¢˜å¤–è¯ï¼š</p>
<blockquote>
<p>æ—¢ç„¶å»ä¿®æ”¹å­—èŠ‚ç ï¼Œä¸ºä½•ä¸ç›´æ¥å¢åŠ å­—æ®µæ–¹æ³•å°±å®Œäº†ï¼Œè¿˜è¦å»å†™ä¸€ä¸ªæ¥å£å‘¢ï¼Ÿ<br>æ¥å£çš„å¥½å¤„å°±æ˜¯ï¼Œæˆ‘å¯ä»¥æŠŠ dto å¼ºåˆ¶è½¬æ¢æ¥è°ƒç”¨æ–¹æ³•ã€‚å¦åˆ™åªèƒ½é€šè¿‡<code>å±æ€§å</code>å»åå°„æ“ä½œè¿™ä¸ªæ‰©å±•çš„å±æ€§<br>é€šè¿‡å­—ç¬¦ä¸²å»åå°„æ“ä½œï¼Œæ˜æ˜¾ä¸å¦‚æ¥å£æ¥çš„æ–¹ä¾¿ã€‚<br>å¦å¤–æ¥å£çš„æ–¹æ³•å¯ä»¥åŠ æ³¨è§£</p>
</blockquote>
<h2 id="2-service-">2.Service å±‚æ‰©å±•</h2>
<hr>
<p>service å±‚çš„æ‰©å±•æ¯”è¾ƒä¸­è§„ä¸­çŸ©ï¼Œæ²¡ä»€ä¹ˆé»‘ç§‘æŠ€ï¼</p>
<p>ä¸»è¦æ˜¯ service çš„æ‰©å±•åº”ç”¨é¢å¤ªçª„ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ä¸æ˜¯è¿™ä¹ˆç®€å•çš„ï¼Œå¯èƒ½éœ€è¦å®Œå…¨çš„æ›¿æ¢ service æ‰è¡Œã€‚</p>
<h3 id="-">æ¥å£</h3>
<p>ä¹Ÿæ˜¯æœ‰ä¸€ä¸ª æ¥å£ ï¼š<code>com.hand.hap.extensible.base.IServiceListener&lt;T&gt;</code>ã€‚<br>é¡ºä¾¿ï¼Œè¿˜åŠ äº†ä¸€ä¸ª Adaptor <code>com.hand.hap.extensible.base.ServiceListenerAdaptor&lt;T&gt;</code>ã€‚   </p>
<blockquote>
<p>è™½ç„¶èµ·å¾—åå­—å« <code>Listener</code> ï¼Œä½†è¿™ä¸ªæ¨¡å¼æ›´åƒ <code>Filter</code> ğŸ˜‚</p>
</blockquote>
<pre><code class="lang-java">@<span class="hljs-keyword">Component</span>
@ServiceListener(target = UserDemoServiceImpl.class)
public class UserDemoServiceListener extends ServiceListenerAdaptor&lt;UserDemo&gt; {

    @<span class="hljs-keyword">Override</span>
    public void beforeUpdate(IRequest request, UserDemo record, ServiceListenerChain&lt;UserDemo&gt; chain) {
        <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-selector-tag">getClass</span>()<span class="hljs-selector-class">.getSimpleName</span>() + "<span class="hljs-selector-pseudo">::beforeUpdate")</span>;
        <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("<span class="hljs-selector-tag">extension</span> <span class="hljs-selector-tag">attribute</span>: <span class="hljs-selector-tag">userPhone</span><span class="hljs-selector-pseudo">:"</span> + ((<span class="hljs-selector-tag">UserDemoExt</span>) <span class="hljs-selector-tag">record</span>)<span class="hljs-selector-class">.getUserPhone</span>());
        <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("<span class="hljs-selector-tag">extension</span> <span class="hljs-selector-tag">attribute</span>: <span class="hljs-selector-tag">endActiveTime</span><span class="hljs-selector-pseudo">:"</span> + ((<span class="hljs-selector-tag">UserDemoExt2</span>) <span class="hljs-selector-tag">record</span>)<span class="hljs-selector-class">.getEndActiveTime</span>());
        <span class="hljs-selector-tag">chain</span><span class="hljs-selector-class">.beforeUpdate</span>(<span class="hljs-selector-tag">request</span>, <span class="hljs-selector-tag">record</span>);
    }

    @<span class="hljs-keyword">Override</span>
    public void afterUpdate(IRequest request, UserDemo record, ServiceListenerChain&lt;UserDemo&gt; chain) {
        <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(<span class="hljs-selector-tag">getClass</span>()<span class="hljs-selector-class">.getSimpleName</span>() + "<span class="hljs-selector-pseudo">::afterUpdate")</span>;
        <span class="hljs-selector-tag">chain</span><span class="hljs-selector-class">.afterUpdate</span>(<span class="hljs-selector-tag">request</span>, <span class="hljs-selector-tag">record</span>);
    }
}
</code></pre>
<p>ç›®å‰å°±åªæœ‰ 3 ç±»ï¼ˆinsertï¼Œupdateï¼Œdeleteï¼‰ 6ä¸ª æ–¹æ³• ï¼ˆåˆ†åˆ«æœ‰ beforeï¼Œafterï¼‰</p>
<p>åœ¨è¿™äº›æ–¹æ³•é‡Œé¢ï¼Œä½ å¯ä»¥å®Œæˆä¸€äº›ç®€å•çš„é€»è¾‘ï¼Œä¹Ÿå¯ä»¥å°†å‚æ•° dto æ›¿æ¢æˆå…¶ä»–çš„å¯é€‚é…çš„å¯¹è±¡ã€‚</p>
<p>è®°å¾—åœ¨æœ€åè°ƒç”¨ <code>chain.xxxx(request, record);</code><br>é™¤éä½ ä¸æƒ³è®©å…¶ä»–çš„ Listener æ‰§è¡Œäº†ã€‚</p>
<h3 id="-">æ³¨è§£</h3>
<p>@ServiceListener
è¿™ä¸ªæ³¨è§£æœ€ä¸»è¦çš„ç›®çš„è¿˜æ˜¯å‘Šè¯‰ HAPï¼Œè¦å¯¹å“ªä¸ª Service è¿›è¡Œ æ‰©å±•ã€‚<br>è¯·æ³¨æ„ï¼Œå¿…é¡»å…·ä½“åˆ°<code>å®ç°ç±»</code>ï¼Œä¸èƒ½åªå†™ä¸€ä¸ªæŠ½è±¡ç±»æˆ–æ¥å£ï¼   </p>
<p>å¦å¤–è¿˜å¯ä»¥ç²—ç•¥çš„æ§åˆ¶é¡ºåº</p>
<ul>
<li>before<br>å¿…é¡»åœ¨å“ªå“ªäº›æ‰©å±•ä¹‹å‰æ‰§è¡Œ</li>
<li>after<br>å¿…é¡»åœ¨å“ªäº›æ‰©å±•ä¹‹åæ‰§è¡Œ</li>
</ul>
<h2 id="3-view-">3.View æ‰©å±•</h2>
<p>è¯·å‚è€ƒ <a href="viewTag/mergeViewTag.md">é¡µé¢æ‰©å±•</a></p>
